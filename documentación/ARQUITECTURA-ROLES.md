# ๐๏ธ Arquitectura de Roles y Navegaciรณn

## ๐ Diagrama de Flujo del Sistema

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        LOGIN PAGE                            โ
โ                    (LoginPage.jsx)                           โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โ Autenticaciรณn con Supabase
              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   AUTH CONTEXT                               โ
โ           Determina rol del usuario                          โ
โ      (rol_id: 1=Bรกsico, 2=Gestor, 3=Admin)                 โ
โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
              โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
              โ             โ             โ              โ
              โผ             โผ             โผ              โผ
      โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
      โ  ROL 1   โ  โ  ROL 2   โ  โ  ROL 3   โ  โ useRole()  โ
      โ  Bรกsico  โ  โ  Gestor  โ  โ  Admin   โ  โ   Hook     โ
      โโโโโโโฌโโโโโ  โโโโโโโฌโโโโโ  โโโโโโโฌโโโโโ  โโโโโโโโโโโโโโ
            โ             โ             โ
            โ             โ             โ
            โผ             โผ             โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    APP.JSX ROUTER                             โ
โ                  (React Router v6)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
            โ
            โ
    โโโโโโโโโดโโโโโโโโโ
    โ                โ
    โผ                โผ
โโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
โ PLAYER  โ    โ ADMIN ROUTES โ
โ ROUTES  โ    โ   (Protect)  โ
โโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
```

## ๐จ Layouts por Contexto

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       USUARIO BรSICO                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Header (Logo + Usuario + Logout)                        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                                                           โ  โ
โ  โ              REPRODUCTOR PRINCIPAL                        โ  โ
โ  โ         (Botรณn Play + Controles + Volumen)               โ  โ
โ  โ                                                           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  [๐]  [๐ป]  [๐]  [๐]  [๐ฌ]                           โ  โ
โ  โ  Repro Canales Conten Histor Soporte                     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  USUARIO GESTOR/ADMIN                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Header (Logo + Usuario + Logout)                        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                                                           โ  โ
โ  โ              REPRODUCTOR PRINCIPAL                        โ  โ
โ  โ         (Botรณn Play + Controles + Volumen)               โ  โ
โ  โ                                                           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  [๐]  [๐ป]  [๐]  [โ]  [๐]  [๐ฌ]  [โ๏ธ Dashboard]    โ  โ
โ  โ  Repro Canales Conten +Anun Histor Soporte   Admin       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ               PANEL DE ADMINISTRACIรN                           โ
โ                  (AdminLayout.jsx)                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  Sidebar  โ                                                     โ
โ  โโโโโโโโ โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ  ๐  โ โ  โ                                            โ    โ
โ  โDashboโ โ  โ         CONTENIDO PRINCIPAL                โ    โ
โ  โard   โ โ  โ                                            โ    โ
โ  โโโโโโโโค โ  โ    - Dashboard con estadรญsticas            โ    โ
โ  โ  ๐บ  โ โ  โ    - Mapa de ubicaciones                   โ    โ
โ  โ Mapa โ โ  โ    - Gestiรณn de anuncios                   โ    โ
โ  โโโโโโโโค โ  โ    - Gestiรณn de grupos                     โ    โ
โ  โ  ๐ข  โ โ  โ                                            โ    โ
โ  โAnunc โ โ  โ                                            โ    โ
โ  โโโโโโโโค โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ  ๐ฅ  โ โ                                                     โ
โ  โGruposโ โ                                                     โ
โ  โโโโโโโโค โ                                                     โ
โ  โ  ๐ป  โ โ                                                     โ
โ  โVolverโ โ                                                     โ
โ  โโโโโโโโ โ                                                     โ
โ            โ                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Matriz de Permisos

| Funcionalidad                    | Bรกsico | Gestor | Admin |
|----------------------------------|--------|--------|-------|
| Acceder al reproductor           | โ     | โ     | โ    |
| Ver canales                      | โ     | โ     | โ    |
| Gestionar contenidos             | โ     | โ     | โ    |
| Ver historial                    | โ     | โ     | โ    |
| Soporte                          | โ     | โ     | โ    |
| Crear anuncios inmediatos        | โ     | โ     | โ    |
| Acceder al panel admin           | โ     | โ     | โ    |
| Ver dashboard de estadรญsticas    | โ     | โ     | โ    |
| Ver mapa de ubicaciones          | โ     | โ     | โ    |
| Crear anuncios rรกpidos           | โ     | โ     | โ    |
| Gestionar grupos de usuarios     | โ     | โ     | โ    |
| Gestionar usuarios del sistema   | โ     | โ     | โ    |
| Configuraciรณn avanzada           | โ     | โ     | โ    |

## ๐บ๏ธ Mapa de Rutas

```
/ (root)
โ
โโโ / .................................................. PlayerPage
โโโ /canales ........................................... ChannelsPage
โโโ /programacion ...................................... ProgrammingPage
โโโ /historial-anuncios ................................ AdHistoryPage
โโโ /soporte ........................................... SupportPage
โ
โโโ /anuncio-nuevo ..................................... NewAdPage
โ   โโโ ๐ Requiere: canCreateImmediateAds (Gestor+)
โ
โโโ /admin ............................................. AdminPage (legacy)
โ   โโโ ๐ Requiere: showAdminPanel (Gestor+)
โ
โโโ /admin/ (rutas protegidas con AdminLayout)
    โ
    โโโ /admin/dashboard ............................... AdminDashboard
    โ   โโโ ๐ Requiere: showAdminPanel (Gestor+)
    โ
    โโโ /admin/mapa .................................... MapPage
    โ   โโโ ๐ Requiere: showAdminPanel (Gestor+)
    โ
    โโโ /admin/anuncios-rapidos ........................ QuickAdsPage
    โ   โโโ ๐ Requiere: canCreateImmediateAds (Gestor+)
    โ
    โโโ /admin/grupos .................................. GroupManagementPage
        โโโ ๐ Requiere: canManageUsers (Gestor+)
```

## ๐ Flujo de Protecciรณn de Rutas

```javascript
// 1. Usuario intenta acceder a /admin/dashboard
Router.navigate('/admin/dashboard')

// 2. App.jsx evalรบa la ruta
<Route path="/admin/dashboard" element={

  // 3. PermissionGated verifica permisos
  <PermissionGated permissions={['showAdminPanel']}>
    
    // 4. useRole() obtiene rol del usuario desde AuthContext
    const { hasPermission } = useRole()
    
    // 5. Si hasPermission('showAdminPanel') === true
    //    โ Renderiza AdminDashboard
    //    โ AdminLayout se encarga del diseรฑo
    <AdminDashboard />
    
    // 6. Si hasPermission('showAdminPanel') === false
    //    โ Renderiza fallback (null por defecto)
    //    โ Usuario no ve nada
    
  </PermissionGated>
} />
```

## ๐ฏ Componentes Clave

### 1. useRole Hook
```javascript
const { 
  userRole,        // Nรบmero: 1, 2, 3
  roleName,        // String: "Bรกsico", "Gestor", "Administrador"
  hasPermission,   // Funciรณn: hasPermission('canDoSomething')
  permissions      // Objeto: { canAccessPlayer: true, ... }
} = useRole()
```

### 2. PermissionGated Component
```javascript
<PermissionGated 
  permissions={['showAdminPanel']} 
  requireAll={false}
  fallback={<AccessDenied />}
>
  <ProtectedContent />
</PermissionGated>
```

### 3. AdminLayout Component
```javascript
<AdminLayout>
  {/* Contenido de la pรกgina admin */}
  <YourAdminPage />
</AdminLayout>
```

## ๐ฑ Responsive Design

```
Desktop (>1024px)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Sidebar โ     Contenido Principal    โ
โ Visible โ     (max-width)             โ
โ 280px   โ                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Desktop Collapsed (>1024px)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Sideโ     Contenido Principal        โ
โ 80pxโ     (max-width expandido)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Mobile (<1024px)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [โฐ]  Contenido a Pantalla Completa  โ
โ                                      โ
โ    (Sidebar en overlay al tocar)    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Ventajas de Esta Arquitectura

### โ Mantenibilidad
- Un solo codebase
- Compartir componentes, servicios y utilidades
- Actualizaciones sincronizadas

### โ Seguridad
- Protecciรณn a nivel de componente
- Verificaciรณn de permisos en cada ruta
- Token รบnico de autenticaciรณn

### โ Performance
- Code splitting automรกtico por rutas
- Tree shaking elimina cรณdigo no usado
- Lazy loading de componentes pesados

### โ Escalabilidad
- Fรกcil agregar nuevos roles
- Fรกcil agregar nuevos permisos
- Fรกcil agregar nuevas pรกginas admin

### โ UX
- Transiciones suaves entre interfaces
- Navegaciรณn intuitiva
- Un solo login para todo

---

**Arquitectura diseรฑada e implementada**: Octubre 2025
**Framework**: React 18 + Vite + React Router v6
**Autenticaciรณn**: Supabase Auth
**Sistema de permisos**: Custom React Hook (useRole)





